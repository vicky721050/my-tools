<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Tools demo</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;margin:18px}
    section{border:1px solid #ddd;padding:12px;margin:12px 0;border-radius:8px}
    label{display:block;margin:6px 0;font-weight:600}
    input,select,button,textarea{padding:8px;margin:6px 0;width:100%;box-sizing:border-box}
    .row{display:flex;gap:12px}
    .col{flex:1}
  </style>
  <!-- CDN libraries -->
  <script src="https://unpkg.com/mathjs@11.8.0/lib/browser/math.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/browser-image-compression/1.0.9/browser-image-compression.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>
  <script src="https://unpkg.com/pixelmatch@5.3.0/dist/pixelmatch.min.js"></script>
</head>
<body>

<h1>Free Tools demo (drop into your site)</h1>

<section id="finance">
  <h2>EMI Calculator (Finance)</h2>
  <label>Loan amount (₹): <input id="loanAmt" type="number" value="500000"></label>
  <label>Annual interest rate (%) : <input id="annualRate" type="number" step="0.01" value="8.5"></label>
  <label>Tenure (years): <input id="years" type="number" value="5"></label>
  <button onclick="calcEMI()">Calculate EMI</button>
  <p id="emiResult"></p>
</section>

<section id="science">
  <h2>Scientific Calculator (math.js)</h2>
  <label>Expression: <input id="expr" value="sin(pi/4) + sqrt(2)"></label>
  <button onclick="evalExpr()">Evaluate</button>
  <p id="exprRes"></p>
</section>

<section id="calorie">
  <h2>Calorie Calculator (Mifflin-St Jeor)</h2>
  <div class="row">
    <div class="col">
      <label>Sex: <select id="sex"><option value="male">Male</option><option value="female">Female</option></select></label>
      <label>Weight (kg): <input id="weight" type="number" value="70"></label>
      <label>Height (cm): <input id="height" type="number" value="175"></label>
      <label>Age (years): <input id="age" type="number" value="30"></label>
      <label>Activity:
        <select id="activity">
          <option value="1.2">Sedentary</option>
          <option value="1.375">Light</option>
          <option value="1.55" selected>Moderate</option>
          <option value="1.725">Very active</option>
          <option value="1.9">Extra active</option>
        </select>
      </label>
      <button onclick="calcCalories()">Calculate Calories</button>
      <p id="calRes"></p>
    </div>
  </div>
</section>

<section id="image-tools">
  <h2>Image Compress → Image PDF</h2>
  <label>Select image(s): <input id="imgIn" type="file" accept="image/*" multiple></label>
  <label>Max size (KB): <input id="maxKb" type="number" value="200"></label>
  <button onclick="compressAndMakePDF()">Compress & Make PDF</button>
  <p id="imgMsg"></p>
</section>

<section id="docx2pdf">
  <h2>Word (.docx) → PDF (browser)</h2>
  <label>Select .docx: <input id="docxIn" type="file" accept=".docx"></label>
  <button onclick="docxToPdf()">Convert to PDF</button>
  <div id="docPreview" style="margin-top:10px"></div>
</section>

<section id="imageCompare">
  <h2>Compare Two Images (pixelmatch)</h2>
  <label>Image A: <input id="imgA" type="file" accept="image/*"></label>
  <label>Image B: <input id="imgB" type="file" accept="image/*"></label>
  <button onclick="compareImages()">Compare</button>
  <p id="compareRes"></p>
  <canvas id="diffCanvas" style="max-width:100%;border:1px solid #ccc"></canvas>
</section>

<script>
  // EMI
  function calcEMI(){
    const P = parseFloat(document.getElementById('loanAmt').value);
    const r = parseFloat(document.getElementById('annualRate').value)/100/12;
    const n = parseInt(document.getElementById('years').value)*12;
    if(!P||!n){ document.getElementById('emiResult').innerText='Enter valid numbers'; return; }
    const emi = (P * r * Math.pow(1+r,n)) / (Math.pow(1+r,n)-1);
    const total = emi * n;
    document.getElementById('emiResult').innerText = `EMI: ₹${emi.toFixed(2)} | Total payment: ₹${total.toFixed(2)}`;
  }

  // math.js expression
  function evalExpr(){
    const e = document.getElementById('expr').value;
    try{
      const res = math.evaluate(e);
      document.getElementById('exprRes').innerText = String(res);
    }catch(err){
      document.getElementById('exprRes').innerText = 'Error: '+err.message;
    }
  }

  // Mifflin-St Jeor calories
  function calcCalories(){
    const sex = document.getElementById('sex').value;
    const w = parseFloat(document.getElementById('weight').value);
    const h = parseFloat(document.getElementById('height').value);
    const a = parseFloat(document.getElementById('age').value);
    const act = parseFloat(document.getElementById('activity').value);
    if(!w||!h||!a){ document.getElementById('calRes').innerText='Enter valid numbers'; return; }
    let bmr;
    if(sex==='male') bmr = 10*w + 6.25*h - 5*a + 5;
    else bmr = 10*w + 6.25*h - 5*a - 161;
    const maintenance = bmr * act;
    document.getElementById('calRes').innerText = `BMR ≈ ${Math.round(bmr)} kcal/day. Maintenance ≈ ${Math.round(maintenance)} kcal/day.`;
  }

  // Image compress + make PDF
  async function compressAndMakePDF(){
    const files = document.getElementById('imgIn').files;
    const maxKb = parseInt(document.getElementById('maxKb').value)||200;
    if(!files.length){ document.getElementById('imgMsg').innerText='Pick images'; return; }
    const imagesHTML = document.createElement('div');
    for(const f of files){
      try{
        const compressed = await imageCompression(f, {maxSizeMB: maxKb/1024, useWebWorker:true});
        const url = URL.createObjectURL(compressed);
        const img = document.createElement('img');
        img.src = url;
        img.style.maxWidth='680px';
        imagesHTML.appendChild(img);
        imagesHTML.appendChild(document.createElement('hr'));
      }catch(err){
        console.error(err);
      }
    }
    document.getElementById('imgMsg').innerText = 'Compressed images ready — creating PDF...';
    // create PDF from imagesHTML using html2pdf
    const opt = { margin:0.5, filename:'images.pdf', html2canvas:{scale:1}, jsPDF:{unit:'in',format:'a4',orientation:'portrait'} };
    await html2pdf().from(imagesHTML).set(opt).save();
    document.getElementById('imgMsg').innerText = 'PDF created and downloaded.';
  }

  // docx -> html -> pdf via mammoth + html2pdf
  async function docxToPdf(){
    const file = document.getElementById('docxIn').files[0];
    if(!file){ alert('Pick a .docx file'); return; }
    const arrayBuffer = await file.arrayBuffer();
    const result = await mammoth.convertToHtml({arrayBuffer});
    const html = result.value;
    const preview = document.getElementById('docPreview');
    preview.innerHTML = '<h3>Preview:</h3>' + html;
    // convert preview to PDF
    const opt = { margin:0.5, filename:'document.pdf', html2canvas:{scale:1}, jsPDF:{unit:'in',format:'a4'} };
    await html2pdf().from(preview).set(opt).save();
  }

  // compare images with pixelmatch
  async function compareImages(){
    const a = document.getElementById('imgA').files[0];
    const b = document.getElementById('imgB').files[0];
    if(!a||!b){ document.getElementById('compareRes').innerText='Choose both images'; return; }
    // load images into canvases
    function loadImg(file){
      return new Promise(res=>{
        const img = new Image();
        img.onload = ()=>res(img);
        img.src = URL.createObjectURL(file);
      });
    }
    const img1 = await loadImg(a);
    const img2 = await loadImg(b);
    const w = Math.max(img1.width, img2.width), h = Math.max(img1.height, img2.height);
    const c1 = document.createElement('canvas'); c1.width=w;c1.height=h;
    const c2 = document.createElement('canvas'); c2.width=w;c2.height=h;
    const ctx1=c1.getContext('2d'), ctx2=c2.getContext('2d');
    ctx1.drawImage(img1,0,0);
    ctx2.drawImage(img2,0,0);
    const d1 = ctx1.getImageData(0,0,w,h);
    const d2 = ctx2.getImageData(0,0,w,h);
    const diff = new Uint8ClampedArray(d1.data.length);
    const diffCanvas = document.getElementById('diffCanvas');
    diffCanvas.width = w; diffCanvas.height = h;
    const n = pixelmatch(d1.data, d2.data, diff, w, h, {threshold:0.1});
    const diffCtx = diffCanvas.getContext('2d');
    const id = new ImageData(diff, w, h);
    diffCtx.putImageData(id, 0, 0);
    document.getElementById('compareRes').innerText = `Different pixels: ${n}`;
  }
</script>
</body>
</html>
